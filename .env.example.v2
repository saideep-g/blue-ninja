# Blue Ninja v2.0 Environment Configuration
# 
# This file contains all environment variables needed for v2.0 platform redesign.
# Copy to .env.local and adjust based on your rollout stage.
# 
# DO NOT commit .env.local to git - keep it local only!

# ============================================================================
# FEATURE FLAGS FOR V2.0 ROLLOUT
# ============================================================================
# 
# Start with all flags DISABLED during internal testing.
# Enable gradually following the rollout plan:
#   Week 1: All disabled (internal testing)
#   Week 2: VALIDATION_V2_ENABLED=true (admin testing)
#   Week 3: QUIZ_V2_ENABLED=true (student beta, 10%)
#   Week 4: Increase to 50%, then 100%
#   Week 5+: Full rollout, v1 deprecated
# 

# Quiz Delivery System
# When true: Students see new multi-template quiz with 14+ question types
# When false: Students see legacy MCQ-only quiz
# Start: false (keep using v1)
# Enable after: Week 3 (after admin testing)
REACT_APP_QUIZ_V2_ENABLED=false

# Admin Panel
# When true: Admins see new admin UI with:
#   - Curriculum browser (tree navigation)
#   - Advanced validation with side-by-side error comparison
#   - Batch operations (bulk edit, publish, delete)
#   - Quality metrics dashboard
# When false: Admins use legacy admin panel
# Start: false
# Enable after: Week 2 (after team validation testing)
REACT_APP_ADMIN_V2_ENABLED=false

# Curriculum Browser in Quiz
# When true: Quiz shows curriculum tree navigation (module → atom → questions)
# When false: Quiz shows flat topic list
# Start: false
# Enable after: Week 3 (with QUIZ_V2_ENABLED)
REACT_APP_CURRICULUM_V2_ENABLED=false

# Validation Engine v2
# When true: Use new 4-tier validation engine for question uploads:
#   Tier 1: Schema validation (required fields, types, format)
#   Tier 2: Template-specific validation (MCQ rules, numeric ranges, etc.)
#   Tier 3: Metadata & curriculum validation (atoms, bloom levels, etc.)
#   Tier 4: Quality assessment (completeness scoring, suggestions)
# When false: Use legacy basic validation
# Start: true (can enable immediately for testing)
# Benefits: Better error messages, AI-friendly feedback, quality scoring
REACT_APP_VALIDATION_V2_ENABLED=true

# ============================================================================
# FIRESTORE CONFIGURATION
# ============================================================================
# 
# These are typically set in your firebase.config.ts and NOT in .env
# Listed here for reference
# 

# Firebase Project ID (from Firebase Console)
# REACT_APP_FIREBASE_PROJECT_ID=blue-ninja-prod

# Enable both v1 and v2 collections during transition
# REACT_APP_ENABLE_V2_COLLECTIONS=true

# ============================================================================
# MIGRATION CONFIGURATION (for scripts only)
# ============================================================================
# 
# These are used by migration scripts during the data transfer phase
# NOT used by the web application
# 

# Batch size for migration (how many documents to process per batch)
# Larger = faster but more memory, smaller = slower but more stable
# Typical: 100 (default)
MIGRATION_BATCH_SIZE=100

# Enable dry-run mode (validate without committing)
# Recommended: true (do this first before actual migration)
MIGRATION_DRY_RUN=true

# After confirming dry-run, set to false for actual migration
# MIGRATION_DRY_RUN=false

# ============================================================================
# FEATURE FLAG SOURCE
# ============================================================================
# 
# Where to fetch feature flag state from:
# 
# local: Use environment variables only (fastest, good for development)
# firestore: Fetch from Firestore (allows per-user overrides in production)
# hybrid: Check Firestore first, fall back to environment variables
# 

REACT_APP_FEATURE_FLAG_SOURCE=local

# ============================================================================
# LOGGING & DEBUG
# ============================================================================
# 
# Enable debug logging for v2.0 systems
# 

# Debug mode: Log all feature flag decisions
REACT_APP_DEBUG_FEATURE_FLAGS=false

# Debug mode: Log all validation details
REACT_APP_DEBUG_VALIDATION=false

# Debug mode: Log all migration steps
REACT_APP_DEBUG_MIGRATION=false

# ============================================================================
# ROLLOUT STAGES (Reference Only - Do Not Edit)
# ============================================================================
# 
# These are for reference. The actual rollout is controlled by the feature
# flags above. This is just documentation of the 5-week plan:
# 
# WEEK 1 (Internal Testing)
#   REACT_APP_QUIZ_V2_ENABLED=false
#   REACT_APP_ADMIN_V2_ENABLED=false
#   REACT_APP_CURRICULUM_V2_ENABLED=false
#   REACT_APP_VALIDATION_V2_ENABLED=true    # Admins testing
#   Description: Admin team validates new validation engine
# 
# WEEK 2 (Admin Beta)
#   REACT_APP_ADMIN_V2_ENABLED=true         # Enable new admin panel
#   Others: false
#   Description: 3-5 admin users test admin panel UX
# 
# WEEK 3 (Student Beta - 10%)
#   REACT_APP_QUIZ_V2_ENABLED=true          # Enable for 10% (via Firestore user flags)
#   REACT_APP_CURRICULUM_V2_ENABLED=true
#   REACT_APP_ADMIN_V2_ENABLED=true
#   Description: Limited student rollout with monitoring
# 
# WEEK 4 (Gradual Rollout)
#   All enabled: true
#   Percentages: Gradually increase from 10% -> 50% -> 90%
#   Description: Monitor performance, gather feedback
# 
# WEEK 5 (Full Rollout)
#   All flags: true (100% of users)
#   Description: Complete migration to v2.0
# 

# ============================================================================
# HOW TO UPDATE DURING ROLLOUT
# ============================================================================
# 
# 1. Local Development:
#    Edit .env.local directly
#    Restart dev server: npm run dev
# 
# 2. Staging Environment:
#    Update .env file in CI/CD pipeline
#    Deploy new version
# 
# 3. Production:
#    Option A - Feature Flags in Firestore (Recommended)
#      Update per-user flags in Firestore: users/{userId}/featureFlags
#      Changes take effect in <1 second
#      No deployment needed
#    
#    Option B - Environment Variables
#      Update CI/CD secrets
#      Trigger redeployment
#      Takes 2-5 minutes to propagate
# 

# ============================================================================
# ROLLBACK PROCEDURE
# ============================================================================
# 
# If critical issue discovered:
# 
# 1. Immediate (< 1 minute):
#    Option A: Disable in Firestore (fastest)
#      Delete featureFlags from affected users
#      OR set QUIZ_V2_ENABLED=false in Firestore
#    Option B: Disable via env vars
#      Set REACT_APP_QUIZ_V2_ENABLED=false
#      Redeploy (takes 2-5 minutes)
# 
# 2. Communication:
#    Notify users/admins of temporary outage
#    Explain what was rolled back
# 
# 3. Investigation:
#    Check error logs
#    Identify root cause
#    Deploy fix
# 
# 4. Re-enable:
#    After fix verified
#    Re-enable feature flag (local or Firestore)
#    Monitor for 24 hours
# 
